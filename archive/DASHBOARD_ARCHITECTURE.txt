╔═══════════════════════════════════════════════════════════════════════════════╗
║                 AUTO ANI DASHBOARD SYSTEM ARCHITECTURE                        ║
╚═══════════════════════════════════════════════════════════════════════════════╝

┌─────────────────────────────────────────────────────────────────────────────┐
│                            FRONTEND LAYER                                    │
└─────────────────────────────────────────────────────────────────────────────┘

┌──────────────────────┐     ┌──────────────────────┐     ┌─────────────────┐
│   Admin Dashboard    │     │   Customer Portal    │     │  Notifications  │
│   /app/admin         │     │   /app/portal        │     │   Component     │
├──────────────────────┤     ├──────────────────────┤     ├─────────────────┤
│ • Overview           │     │ • Passwordless Auth  │     │ • Bell Icon     │
│ • Inventory          │     │ • Inquiry Tracking   │     │ • Unread Count  │
│ • Customers          │     │ • Status Updates     │     │ • Auto-refresh  │
│ • Orders             │     │ • Communication      │     │ • Action Links  │
│ • Analytics ⭐       │     │ • History View       │     │ • Categories    │
│ • Facebook Sync      │     │ • Vehicle Details    │     │ • Mark Read     │
└──────────────────────┘     └──────────────────────┘     └─────────────────┘
         │                            │                            │
         └────────────────────────────┴────────────────────────────┘
                                      │
                        ┌─────────────▼────────────┐
                        │   ANALYTICS DASHBOARDS   │
                        └──────────────────────────┘

┌────────────────────┐  ┌────────────────────┐  ┌────────────────────┐
│  Sales Analytics   │  │ Inventory Analysis │  │ Customer Insights  │
├────────────────────┤  ├────────────────────┤  ├────────────────────┤
│ 📊 Conversion      │  │ 📦 Status Dist.    │  │ 👥 Lead Scoring    │
│    Funnel          │  │ ⏱️  Days in Stock   │  │ 🌡️  Temperature    │
│ 💰 Revenue         │  │ 🏆 Top Vehicles    │  │ 📈 Acquisition     │
│ 🚗 Sales by Type   │  │ 🔄 Turnover Rate   │  │ 💵 Price Prefs     │
│ 🏭 Revenue by Make │  │ ⚠️  Aging Alert    │  │ 🔍 Search Table    │
└────────────────────┘  └────────────────────┘  └────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│                         VISUALIZATION LAYER                                  │
└─────────────────────────────────────────────────────────────────────────────┘

┌──────────────┐  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐
│  Area Charts │  │  Pie Charts  │  │  Bar Charts  │  │ Line Charts  │
├──────────────┤  ├──────────────┤  ├──────────────┤  ├──────────────┤
│ • Trends     │  │ • Distribution│  │ • Comparisons│  │ • Time Series│
│ • Stacked    │  │ • Segments   │  │ • Rankings   │  │ • Growth     │
│ • Filled     │  │ • Percentages│  │ • Categories │  │ • Patterns   │
└──────────────┘  └──────────────┘  └──────────────┘  └──────────────┘
       │                 │                 │                 │
       └─────────────────┴─────────────────┴─────────────────┘
                              │
                    ┌─────────▼──────────┐
                    │   Recharts v3.2    │
                    │   Chart.js v4.5    │
                    └────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│                            API LAYER                                         │
└─────────────────────────────────────────────────────────────────────────────┘

┌────────────────────┐  ┌────────────────────┐  ┌────────────────────┐
│  Analytics API     │  │  Export API        │  │  Notifications     │
│  /api/admin/       │  │  /api/admin/       │  │  /api/admin/       │
│  analytics         │  │  export            │  │  notifications     │
├────────────────────┤  ├────────────────────┤  ├────────────────────┤
│ GET ?type=         │  │ POST ?type=        │  │ GET                │
│ • overview         │  │ • vehicles         │  │ POST /read-all     │
│ • sales            │  │ • inquiries        │  │ PATCH /:id/read    │
│ • inventory        │  │ • contacts         │  │ DELETE /:id        │
│ • customer         │  │ • analytics        │  └────────────────────┘
│                    │  │ • overview         │
│ GET ?range=        │  │                    │  ┌────────────────────┐
│ • 7d               │  │ POST ?format=      │  │  Portal API        │
│ • 30d              │  │ • csv              │  │  /api/portal/      │
│ • 90d              │  │ • json             │  ├────────────────────┤
│ • 1y               │  └────────────────────┘  │ POST /verify       │
└────────────────────┘                          │ POST /login        │
                                                └────────────────────┘
         │                      │                        │
         └──────────────────────┴────────────────────────┘
                                │
┌─────────────────────────────────────────────────────────────────────────────┐
│                         DATABASE LAYER                                       │
└─────────────────────────────────────────────────────────────────────────────┘

                        ┌────────────────────┐
                        │   Prisma ORM       │
                        │   v6.16.2          │
                        └─────────┬──────────┘
                                  │
        ┌─────────────────────────┼─────────────────────────┐
        │                         │                         │
┌───────▼────────┐    ┌──────────▼─────────┐    ┌─────────▼────────┐
│   Vehicle      │    │  VehicleInquiry    │    │    Contact       │
├────────────────┤    ├────────────────────┤    ├──────────────────┤
│ • id           │◄───┤ • vehicleId (FK)   │    │ • id             │
│ • make         │    │ • name             │    │ • name           │
│ • model        │    │ • email            │    │ • email          │
│ • year         │    │ • phone            │    │ • phone          │
│ • price        │    │ • status           │    │ • message        │
│ • status       │    │ • inquiryType      │    │ • status         │
│ • featured     │    │ • message          │    │ • createdAt      │
│ • createdAt    │    │ • createdAt        │    └──────────────────┘
└────────────────┘    └────────────────────┘

                    Indexes for Performance:
            ┌──────────────────────────────────┐
            │ • [status, createdAt]            │
            │ • [make, status]                 │
            │ • [vehicleId, status]            │
            │ • [email]                        │
            │ • [price, mileage, status]       │
            └──────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│                         DATA FLOW DIAGRAM                                    │
└─────────────────────────────────────────────────────────────────────────────┘

1. USER REQUEST
   │
   ▼
2. NEXT.JS API ROUTE
   │
   ├─► Authentication Check (NextAuth)
   │
   ▼
3. PRISMA QUERY
   │
   ├─► Database Query with Indexes
   ├─► Joins & Aggregations
   ├─► Date Filtering
   │
   ▼
4. DATA PROCESSING
   │
   ├─► Format with date-fns
   ├─► Calculate Metrics
   ├─► Group & Sort
   │
   ▼
5. API RESPONSE (JSON)
   │
   ▼
6. FRONTEND COMPONENT
   │
   ├─► State Management (React useState)
   ├─► Recharts Rendering
   ├─► Interactive Updates
   │
   ▼
7. USER INTERACTION
   │
   ├─► Time Range Change → New API Call
   ├─► Export Click → Download CSV/JSON
   ├─► Search Filter → Local State Update
   └─► Notification Click → Mark as Read

┌─────────────────────────────────────────────────────────────────────────────┐
│                    LEAD SCORING SYSTEM FLOW                                  │
└─────────────────────────────────────────────────────────────────────────────┘

Customer Inquiry
      │
      ▼
┌─────────────────┐
│  Data Collection│
├─────────────────┤
│ • Email         │
│ • Name          │
│ • Vehicle Price │
│ • Timestamp     │
└────────┬────────┘
         │
         ▼
┌─────────────────────────┐
│  Score Calculation      │
├─────────────────────────┤
│ Recency Score (30 pts)  │
│ ├─ Days since activity  │
│ └─ Score: 30 - days     │
│                         │
│ Frequency Score (40 pts)│
│ ├─ Inquiry count        │
│ └─ Score: count × 10    │
│                         │
│ Value Score (30 pts)    │
│ ├─ Avg vehicle price    │
│ └─ Score: price / 1000  │
└────────┬────────────────┘
         │
         ▼
┌─────────────────────────┐
│ Temperature Assignment  │
├─────────────────────────┤
│ 70-100 → 🔥 HOT        │
│ 40-69  → 🟠 WARM       │
│ 0-39   → 🔵 COLD       │
└────────┬────────────────┘
         │
         ▼
┌─────────────────────────┐
│  Dashboard Display      │
├─────────────────────────┤
│ • Sorted by Score       │
│ • Color-coded Badges    │
│ • Search & Filter       │
│ • Contact Actions       │
└─────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│                     EXPORT SYSTEM ARCHITECTURE                               │
└─────────────────────────────────────────────────────────────────────────────┘

User Clicks Export Button
         │
         ▼
┌────────────────────────┐
│  Frontend Triggers     │
│  API Call              │
└────────┬───────────────┘
         │
         ▼
┌────────────────────────┐
│  Export API Route      │
│  /api/admin/export     │
├────────────────────────┤
│ • Validate Auth        │
│ • Get Export Type      │
│ • Get Format (CSV/JSON)│
└────────┬───────────────┘
         │
         ▼
┌────────────────────────┐
│  Database Query        │
├────────────────────────┤
│ • Vehicles             │
│ • Inquiries            │
│ • Contacts             │
│ • Analytics            │
│ • Overview             │
└────────┬───────────────┘
         │
         ▼
┌────────────────────────┐
│  Format Data           │
├────────────────────────┤
│ CSV: Comma-separated   │
│ JSON: Structured       │
│ Headers & Rows         │
└────────┬───────────────┘
         │
         ▼
┌────────────────────────┐
│  HTTP Response         │
├────────────────────────┤
│ Content-Type: text/csv │
│ Content-Disposition:   │
│   attachment           │
└────────┬───────────────┘
         │
         ▼
    Browser Download
    filename-YYYY-MM-DD.csv

┌─────────────────────────────────────────────────────────────────────────────┐
│                    TECHNOLOGY STACK OVERVIEW                                 │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────┐   ┌─────────────────┐   ┌─────────────────┐
│   FRONTEND      │   │   BACKEND       │   │   DATABASE      │
├─────────────────┤   ├─────────────────┤   ├─────────────────┤
│ React 18.3      │   │ Next.js 15      │   │ Prisma 6.16     │
│ TypeScript      │   │ API Routes      │   │ SQLite (Dev)    │
│ Tailwind CSS 4  │   │ NextAuth 4.24   │   │ PostgreSQL      │
│ Radix UI        │   │ date-fns 4.1    │   │   (Production)  │
│ Recharts 3.2    │   │ zod 4.1         │   └─────────────────┘
│ Chart.js 4.5    │   └─────────────────┘
└─────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│                         SECURITY MEASURES                                    │
└─────────────────────────────────────────────────────────────────────────────┘

✅ Authentication Layer
   • NextAuth session validation
   • Role-based access control (ADMIN only)
   • Secure token management

✅ API Security
   • Request validation with zod
   • SQL injection prevention (Prisma)
   • Rate limiting ready
   • CORS configuration

✅ Data Protection
   • Email verification for portal
   • No sensitive data in URLs
   • Secure password hashing (bcryptjs)
   • Environment variable usage

┌─────────────────────────────────────────────────────────────────────────────┐
│                    PERFORMANCE OPTIMIZATIONS                                 │
└─────────────────────────────────────────────────────────────────────────────┘

✅ Database Level
   • Indexed queries for fast lookups
   • Optimized joins and aggregations
   • Selective field loading
   • Connection pooling

✅ API Level
   • Efficient Prisma queries
   • Parallel query execution
   • Date range filtering
   • Result pagination

✅ Frontend Level
   • React state optimization
   • Memoization where needed
   • Lazy loading components
   • Chart rendering optimization

✅ Network Level
   • API response caching
   • Compressed payloads
   • CDN ready
   • HTTP/2 support

═══════════════════════════════════════════════════════════════════════════════

                          🎯 PROJECT COMPLETE 🎯

All dashboard components have been successfully implemented with enterprise-
grade features including real-time analytics, lead scoring, export capabilities,
customer portal, and comprehensive business intelligence tools.

The system is production-ready and can be deployed immediately!

═══════════════════════════════════════════════════════════════════════════════
